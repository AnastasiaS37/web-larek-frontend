# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка
```
npm run build
```

или

```
yarn build
```
## Типы данных, используемые в приложении
Интерфейс `IItem` для учёта товаров в приложении:
interface IItem {
    id: string;
    title: string;
    image: string;
    price: number | null;
    category: string;
    description: string;
}

Интерфейс `ICustomer` для учёта данных пользователя:
interface ICustomer {
    email: string;
    phone: string;
    payment: 'online' | 'cash' | '';
    address: string;
}

## Архитектура приложения

Архитектура проекта разрабатывается с использованием паттерна MVP, в котором основными слоями являются:
1. Слой данных, отвечающий за работу с данными (хранение и изменение).
2. Слой представления, отвечающий за отображение данных на старнице.
3. Презенетер, отвечающий за связь данных и представления.

### Базовые классы

#### Класс EventEmitter
Класс `EventEmitter` обеспечивает работу событий. Он позволяет отправлять события и подписываться на них. Данный класс используется в слоях приложения для генерации событий и в презентере для обработки событий.
Основные методы класса:
- `on` - установка обработчика на событие
- `off` - снятие обработчика с события
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое событие

#### Класс Api
Класс `Api` реализует базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Основные методы класса: 
- `get` - выполняет GET запрос и возвращает промис с ответом сервера
- `post` - принимает объект с данными и отправляет эти данные на сервер. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

### Слой данных

#### Класс ItemsData
Класс `ItemsData` отвечает за хранение массива всех товаров (каталог) и выбранной пользователем для просмотра карточки. У класса есть следующие поля:
- защищённое поле `ItemsArray`, в котором хранится массив объектов типа `IItem`
- защищённое поле `SelectedCard`, в котором хранится объекта типа `IItem` (выбранная карточка)
Конструктор класса принимает инстант брокера событий.
У класса есть следующие методы:
- `setItems`, принимающий в качестве параметра массив объектов типа `IItem`, - позволяет сохранить массив товаров
- `getItems`, возвращающий массив объектов типа `IItem`, - позволяет получить массив товаров
- `setItem`, принимающий в качестве параметра объект типа `IItem`, - позволяет сохранить выбранную пользователем карточку товара
- `getItem`, возвращающий объект типа `IItem`, - позволяет получить выбранную пользователем карточку товара

#### Класс BasketData
Класс `Basket` отвечает за хранение массива товаров, находящихся в корзине. У класса есть следующие поля:
- защищённое поле `ItemsArray`, в котором хранится массив объектов типа `IItem`
Конструктор класса принимает инстант брокера событий.
У класса есть следующие методы:
- `getItems`, возвращающий массив объектов типа `IItem`, - позволяет получить массив товаров в корзине
- `addItem`, принимающий в качестве параметра объект типа `IItem`, - позволяет добавить товар в корзину
- `deleteItem`, принимающий в качестве параметра id товара, - позволяет удалить товар из корзины
- `getTotalPrice`, возвращающий число, - позволяет получить суммарную стоимость товаров
- `getTotalItems`, возвращающий число, - позволяет получить количество товаров в корзине
- `isInBasket`, принимающий в качестве параметра id товара и возвращающий boolean, - позволяет узнать наличие товара с данным id в корзине

#### Класс CustomerData
Класс `CustomerData` отвечает за хранение данных покупателя. У класса есть следующие поля:
- поле `email`, в котором хранится массив объектов типа string
- поле `phone`, в котором хранится массив объектов типа string
- поле `payment`, которое может принимать одно из трёх значений: 'online', 'cash' или '' (пустая строка)
- поле `address`, в котором хранится массив объектов типа string
Конструктор класса принимает инстант брокера событий.
У класса есть следующие методы:
- `setData`, принимающий в качестве параметра объект типа `ICustomer`, - позволяет сохранить данные покупателя
- `getData`, возвращающий объект типа `ICustomer`, - позволяет получить данные покупателя
- `validateData`, принимающий в качестве параметра объект типа `ICustomer` и возвращающий результат этой проверки, - позволяет проверить (валидировать) данные покупателя

### Слой представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемента) передаваемых в них данных.

#### Базовый Класс Component
Класс `Component` является базовым для всех классов представления. В дженерик принимает тип объекта, в котором данные будут передаваться в метод render для отображения данных в компоненте. В конструктор принимает элемент разметки, являющийся основным родительским контейнером компонента. Содержит метод render, отвечающий за сохранение полученных в параметре данных в полях компонентов через их сеттеры, возвращает обновленный контейнер компонента.

#### Класс Header
Класс `Header` отвечает за отображение шапки сайта. Устанавливает значение счётчика корзины и устанавливает слушатель на значок корзины.
Поля класса:
- counterElement: HTMLElement - элемент счётчика
- basketButton: HTMLButtonElement - элемент корзины
Метод класса:
- set counter(value: number) - устанавливает значение счётчика

#### Класс Gallery
Класс `Gallery` отвечает за отображение списка карточек товаров (каталога).
Поле класса:
- catalogElement: HTMLElement - элемент каталога
Метод класса:
- set catalog(items: HTMLElement[]) - устанавливает в контейнер  элементы карточек, переданные в виде массива HTML-элементов

#### Класс Modal
Класс `Modal` отвечает за отображение модального окна, содержимое которого может быть разным, в зависимости от выбранного для отображения из разметки шаблона. Устанавливает слушатель на значок закрытия модального окна.
Поля класса:
- contentElement: HTMLElement - элемент модального окна
- closeButton: HTMLButtonElement - кнопка закрытия модального окна
Метод класса:
- set content(item: HTMLElement) - устанавливает в контейнер  переданный HTML-элемент

#### Класс Success
Класс `Success` отвечает за отображение окна успешной покупки. Устанавливает слушатель на кнопку продолжения покупок.
Поля класса:
- descriptionElement: HTMLElement
- closeButton: HTMLButtonElement

#### Класс Basket
Класс `Basket` отвечает за отображение корзины с выбранными товарами. Позволяет отображать список карточек товаров и суммарную стоимость товаров в корзине.
Поля класса:
- contentElement: HTMLElement
- basketButton: HTMLButtonElement
- priceElement: HTMLElement
Методы класса:
- set content(items: HTMLElement[]) - устанавливает в контейнер переданный в параметре массив HTML-элементов (карточек товаров)
- set price(value: number) - устанавливает значение суммарной стоимости корзины

#### Класс Card
Класс `Card` является наследуемым для классов `GalleryItem`, `ModalItem` и `BasketItem`, которые отвечают за отображение карточки товара в разных вариантах.
Поля класса:
- itemTitle: HTMLElement
- itemPrice: HTMLElement
Методы класса:
- set title(value: string) - устанавливает заголовок карточки (название товара) 
- set price(value: number | null) - устанавливает цену товара, можем принимать число или null для бесценного товара

#### Класс GalleryItem
Класс `GalleryItem` наследует класс `Card` и отвечает за отображение карточки товара в каталоге товаров.
Поля класса:
- itemImage: HTMLImageElement
- itemCategory: HTMLElement
Методы класса:
- set image(value: string) - устанавливает изображение товара
- set category(value: string) - устанавливает категорию товара

#### Класс ModalItem
Класс `ModalItem` наследует класс `Card` и отвечает за отображение карточки товара в модальном окне.
Поля класса:
- itemDescription: HTMLElement
- itemButton: HTMLButtonElement
Методы класса:
- set description(value: string) - устанавливает описание товара
- set buttonText(value: string) - устанавливает текст кнопки для добавления/удаления товара из корзины в зависимости от его наличия там.

#### Класс BasketItem
Класс `BasketItem` наследует класс `Card` и отвечает за отображение карточки товара в корзине и устанавливает слушатель на кнопку удаления товара.
Поле класса:
- itemButton: HTMLButtonElement
Метод класса:
- set itemNumber(value: number) - устанавливает порядковый номер товара в корзине

#### Класс Form
Класс `Form` является наследуемым для классов `OrderForm` и `ContactForm`, которые отвечают за отображение форм покупки.
Поле класса:
- buttonElement: HTMLButtonElement
Метод класса:
- set valid(value: boolean) - изменяет состояние кнопки в зависимости от валидации формы

#### Класс OrderForm
Класс `OrderForm` наследует класс `Form` и отвечает за отображение формы заказа и устанавливает слушатель на кнопки выбара типа оплаты.
Поля класса:
- cardButtonElement: HTMLButtonElement
- cashButtonElement: HTMLButtonElement
- adressInput: HTMLInputElement
Метод класса:
- set adress(value: string) - устанавливает адрес доставки

#### Класс ContactForm
Класс `ContactForm` наследует класс `Form` и отвечает за отображение контактной формы.
- emailInput: HTMLInputElement
- phoneInput: HTMLInputElement
Методы класса:
- set email(value: string) - устанавливает email пользователя
- set phone(value: string) - устанавливает номер телефона пользователя

### Слой коммуникации

#### Класс AppApi
Класс `AppApi` наследует базовый класс `Api` и отвечает за работу с сервером.

### Взаимодействие компонентов
Код презентера, описывающего связь данных и представления, будет содержаться в основном скрипте приложения `index.ts`. Взаимодействие осуществляется за счёт событий, генерируемых с помощью брокера событий, и обработчиков этих событий.

В работе используется событийно-ориентированный подход. Список событий, которые могут генерироваться в системе:
*События изменения данных (генерируются классами модели данных)*
- `items:changed` - добавление списка товаров в модель данных
- `basket:changed` - изменение состояния корзины
- `user:changed` - изменение данных пользователя
- `user:valid` - данные пользователя прошли валидацию
- `card:selected` - изменение открываемой в модальном окне карточки
<!-- - `item:added` - добавление товара в корзину
- `item:deleted` - удаление товара из корзины -->
*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*
- `card:open` - выбор карточки для отображения в модальном окне
- `selectedItem:basketAction` - добавление или удаление товара из корзины
<!-- - `selectedItem:added` - добавление товара в корзину
- `selectedItem:deleted` - удаление товара из корзины -->
- `basket:open` - открытие модального окна корзины
- `basket:submit` - выбор оформления заказа товаров, находящихся в корзине
- `orderForm:open` - открытие модального окна с формой заказа
- `orderForm:valid` - форма заказа прошла валидацию
- `contactForm:open` - открытие модального окна с формой контактных данных пользователя
- `contactForm:valid` - форма контактных данных прошла валидацию
- `success:continue` - выбор продолжения покупок в форме успешной покупки
<!-- - `modal:open`
- `modal:close` -->

Пример взаимодействия:
1. Пользователь нажимает на добавление товара в корзину (кнопка "Купить"). Класс `ModalItem` реагирует на действие пользователя и генерирует событие `selectedItem:added`.
2. Презентер обрабатывает событие и вызывает метод `addItem` класса `BasketData`.
3. Модель изменяет данные в поле `ItemsArray` класса `BasketData` и генерирует событие `item:added`.
4. Презентер обрабатывает событие и вызывает рендер класса `Basket`, передавая в него данные из модели.
5. Класс `Basket` перерисовывается, отображая обновлённые данные.