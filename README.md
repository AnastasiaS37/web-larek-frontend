# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка
```
npm run build
```

или

```
yarn build
```
## Типы данных, используемые в приложении
Интерфейс `IItem` для учёта товаров в приложении:
interface IItem {
    id: string;
    title: string;
    image: string;
    price: number | null;
    category: string;
    description: string;
}

Интерфейс `ICustomer` для учёта данных пользователя:
interface ICustomer {
    email: string;
    phone: string;
    payment: 'online' | 'cash' | '';
    address: string;
}

## Архитектура приложения

Архитектура проекта разрабатывается с использованием паттерна MVP, в котором основными слоями являются:
1. Слой данных, отвечающий за работу с данными (хранение и изменение).
2. Слой представления, отвечающий за отображение данных на старнице.
3. Презенетер, отвечающий за связь данных и представления.

### Базовые классы

#### Класс EventEmitter
Класс `EventEmitter` обеспечивает работу событий. Он позволяет отправлять события и подписываться на них. Данный класс используется в слоях приложения для генерации событий и в презентере для обработки событий.
Основные методы класса:
- `on` - установка обработчика на событие
- `off` - снятие обработчика с события
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое событие

#### Класс Api
Класс `Api` реализует базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Основные методы класса: 
- `get` - выполняет GET запрос и возвращает промис с ответом сервера
- `post` - принимает объект с данными и отправляет эти данные на сервер. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

### Слой данных

#### Класс ItemsData
Класс `ItemsData` отвечает за хранение массива всех товаров (каталог) и выбранной пользователем для просмотра карточки. У класса есть следующие поля:
- защищённое поле `ItemsArray`, в котором хранится массив объектов типа `IItem`
- защищённое поле `SelectedCard`, в котором хранится объекта типа `IItem` (выбранная карточка)
Конструктор класса принимает инстант брокера событий.
У класса есть следующие методы:
- `setItems`, принимающий в качестве параметра массив объектов типа `IItem`, - позволяет сохранить массив товаров
- `getItems`, возвращающий массив объектов типа `IItem`, - позволяет получить массив товаров
- `setItem`, принимающий в качестве параметра объект типа `IItem`, - позволяет сохранить выбранную пользователем карточку товара
- `getItem`, возвращающий объект типа `IItem`, - позволяет получить выбранную пользователем карточку товара
- `getItemById`, принимающий в качестве параметра id товара (объект типа string) и возвращающий объект типа `IItem`, - позволяет получить карточку товара по её id

#### Класс BasketData
Класс `Basket` отвечает за хранение массива товаров, находящихся в корзине. У класса есть следующие поля:
- защищённое поле `ItemsArray`, в котором хранится массив объектов типа `IItem`
Конструктор класса принимает инстант брокера событий.
У класса есть следующие методы:
- `getItems`, возвращающий массив объектов типа `IItem`, - позволяет получить массив товаров в корзине
- `addItem`, принимающий в качестве параметра объект типа `IItem`, - позволяет добавить товар в корзину
- `deleteItem`, принимающий в качестве параметра id товара, - позволяет удалить товар из корзины
- `getTotalPrice`, возвращающий число, - позволяет получить суммарную стоимость товаров
- `getTotalItems`, возвращающий число, - позволяет получить количество товаров в корзине
- `isInBasket`, принимающий в качестве параметра id товара и возвращающий boolean, - позволяет узнать наличие товара с данным id в корзине
- `clearBasket`, позволяющий очистить корзину

#### Класс CustomerData
Класс `CustomerData` отвечает за хранение данных покупателя. У класса есть следующие поля:
- поле `email`, в котором хранится массив объектов типа string
- поле `phone`, в котором хранится массив объектов типа string
- поле `payment`, которое имеет тип `TPayment` и может принимать одно из трёх значений: 'online', 'cash' или '' (пустая строка)
- поле `address`, в котором хранится массив объектов типа string
- поле `formErrors`, которое является объектом типа `Partial<Record<keyof ICustomer, string>>` и хранит ошибки валидации
Конструктор класса принимает инстант брокера событий.
У класса есть следующие методы:
- `setField`, принимающий в качестве параметров один из ключей объекта `ICustomer` и значение типа string, - позволяет сохранить данные покупателя
- `getUserData`, возвращающий объект типа `ICustomer`, - позволяет получить данные покупателя
- `validateData`, возвращающий объект `formErrors`, который содержит ошибки валидации
- `clearData`, позволяющий очистить данные покупателя, которые сохранены в модели

### Слой представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемента) передаваемых в них данных.

#### Базовый Класс Component
Класс `Component` является базовым для всех классов представления. В дженерик принимает тип объекта, в котором данные будут передаваться в метод render для отображения данных в компоненте. В конструктор принимает элемент разметки, являющийся основным родительским контейнером компонента. Содержит метод render, отвечающий за сохранение полученных в параметре данных в полях компонентов через их сеттеры, возвращает обновленный контейнер компонента.

#### Класс Header
Класс `Header` отвечает за отображение шапки сайта. Устанавливает значение счётчика корзины и устанавливает слушатель на значок корзины.
Поля класса:
- counterElement: HTMLElement - элемент счётчика
- basketButton: HTMLButtonElement - элемент корзины
Метод класса:
- set counter(value: number) - устанавливает значение счётчика

#### Класс Gallery
Класс `Gallery` отвечает за отображение списка карточек товаров (каталога).
Поле класса:
- catalogElement: HTMLElement - элемент каталога
Методы класса:
- set catalog(items: HTMLElement[]) - устанавливает в контейнер элементы карточек, переданные в виде массива HTML-элементов
- set locked(value: boolean) - позволяет блокировать и разблокировать прокрутку страницы при открытии модального окна

#### Класс Modal
Класс `Modal` отвечает за отображение модального окна, содержимое которого может быть разным, в зависимости от выбранного для отображения из разметки шаблона. Устанавливает слушатель на значок закрытия модального окна и на нажатие на оверлей.
Поля класса:
- contentElement: HTMLElement - элемент модального окна
- closeButton: HTMLButtonElement - кнопка закрытия модального окна
Методы класса:
- set content(item: HTMLElement) - устанавливает в контейнер переданный HTML-элемент
- open() - отвечает за открытие модального окна и генерирует соответствующее событие
- close() - отвечает за закрытие модального окна и генерирует соответствующее событие
- render() - расширяет метод render базового класса, добавляя открытие модального окна

#### Класс Success
Класс `Success` отвечает за отображение окна успешной покупки. Устанавливает слушатель на кнопку продолжения покупок.
Поля класса:
- descriptionElement: HTMLElement
- closeButton: HTMLButtonElement
Метод класса:
- set total(value: number) - устанавливает сообщение о сумме совершённой покупки

#### Класс Basket
Класс `Basket` отвечает за отображение корзины с выбранными товарами. Позволяет отображать список карточек товаров и суммарную стоимость товаров в корзине.
Поля класса:
- contentElement: HTMLElement
- basketButton: HTMLButtonElement
- priceElement: HTMLElement
Методы класса:
- set content(items: HTMLElement[]) - устанавливает в контейнер переданный в параметре массив HTML-элементов (карточек товаров) или (в случае пустого массива) выводит сообщение об отсутствии товаров в корзине
- set price(value: number) - устанавливает значение суммарной стоимости корзины

#### Класс Card
Класс `Card` является наследуемым для классов `GalleryItem`, `ModalItem` и `BasketItem`, которые отвечают за отображение карточки товара в разных вариантах.
Поля класса:
- itemTitle: HTMLElement
- itemPrice: HTMLElement
- itemId: string
Методы класса:
- set title(value: string) - устанавливает заголовок карточки (название товара) 
- set price(value: number | null) - устанавливает цену товара, может принимать число или null для бесценного товара
- set id(value: string) - устанавливает id товара, чтобы передавать его при генерации событий в дочерних классах

#### Класс GalleryItem
Класс `GalleryItem` наследует класс `Card` и отвечает за отображение карточки товара в каталоге товаров. Устанавливает слушатель на клик по карточке.
Поля класса:
- itemImage: HTMLImageElement
- itemCategory: HTMLElement
Методы класса:
- set image(value: string) - устанавливает изображение товара
- set category(value: string) - устанавливает категорию товара

#### Класс ModalItem
Класс `ModalItem` наследует класс `GalleryItem` и отвечает за отображение карточки товара в модальном окне. Устанавливает слушатель на клик по кнопке добавления в корзину.
Поля класса:
- itemDescription: HTMLElement
- itemButton: HTMLButtonElement
Методы класса:
- set description(value: string) - устанавливает описание товара
- set buttonText(value: string) - устанавливает текст кнопки для добавления/удаления товара из корзины в зависимости от его наличия там.
- set price(value: number | null) - расширяет метод price родительского класса, делая недоступной кнопку добавления в корзину для бесценного товара

#### Класс BasketItem
Класс `BasketItem` наследует класс `Card` и отвечает за отображение карточки товара в корзине. Устанавливает слушатель на кнопку удаления товара.
Поля класса:
- itemButton: HTMLButtonElement
- itemIndex: HTMLElement
Метод класса:
- set itemNumber(value: number) - устанавливает порядковый номер товара в корзине

#### Класс Form
Класс `Form` является наследуемым для классов `OrderForm` и `ContactForm`, которые отвечают за отображение форм покупки. Устанавливает слушатель события input на поля формы и слушатель клика на отправку формы.
Поля класса:
- buttonElement: HTMLButtonElement
- errorElement: HTMLElement
Методы класса:
- onInputChange(field: keyof T, value: string) - генерирует события с разными названиями и параметрами, в зависимости от передаваемых ему параметров
- set valid(value: boolean) - изменяет состояние кнопки в зависимости от валидации формы
- set errors(value: string[]) - выводит текст ошибок при неправильном заполнении формы
- render(state: Partial<T> & Partial<IForm>) - расширяет метод render базового класса, добавляя вывод сообщений об ошибках

#### Класс OrderForm
Класс `OrderForm` наследует класс `Form` и отвечает за отображение формы заказа. Устанавливает слушатели на кнопки выбора типа оплаты.
Поля класса:
- cardButtonElement: HTMLButtonElement
- cashButtonElement: HTMLButtonElement
- adressInput: HTMLInputElement
Методы класса:
- changeButtonState(isCard: boolean, isCash: boolean) - визуализирует выбранный тип оплаты
- set address(value: string) - устанавливает адрес доставки

#### Класс ContactForm
Класс `ContactForm` наследует класс `Form` и отвечает за отображение контактной формы.
Поля класса:
- emailInput: HTMLInputElement
- phoneInput: HTMLInputElement
Методы класса:
- set email(value: string) - устанавливает email пользователя
- set phone(value: string) - устанавливает номер телефона пользователя

### Слой коммуникации

#### Класс AppApi
Класс `AppApi` наследует базовый класс `Api` и отвечает за работу с сервером.

### Взаимодействие компонентов
Код презентера, описывающего связь данных и представления, будет содержаться в основном скрипте приложения `index.ts`. Взаимодействие осуществляется за счёт событий, генерируемых с помощью брокера событий, и обработчиков этих событий.

В работе используется событийно-ориентированный подход. Список событий, которые могут генерироваться в системе:

*События изменения данных (генерируются классами модели данных)*
- `items:changed` - добавление списка товаров в модель данных
- `card:selected` - изменение открываемой в модальном окне карточки
- `basket:changed` - изменение состояния корзины
- `payment:changed` - изменение способа оплаты

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*
- `card:open` - выбор карточки для отображения в модальном окне
- `selectedItem:basketAction` - изменение состояния товара в корзине
- `basket:open` - открытие модального окна корзины
- `basket:submit` - выбор оформления заказа товаров, находящихся в корзине
- `order.*.changed` - изменение одного из полей формы order
- `order:submit` - подтверждение формы order
- `contacts.*.changed` - изменение одного из полей формы contacts
- `contacts:submit` - подтверждение формы contacts (подтверждение оплаты)
- `modal:open` - открытие модального окна
- `modal:close` - закрытие модального окна

Пример взаимодействия:
1. Пользователь нажимает на удаление товара из корзины в модальном окне корзины. Класс `BasketItem` реагирует на действие пользователя и генерирует событие `selectedItem:basketAction`.
2. Презентер обрабатывает событие и вызывает метод `deleteItem` класса `BasketData`.
3. Модель изменяет данные в поле `ItemsArray` класса `BasketData` и генерирует событие `basket:changed`.
4. Презентер обрабатывает событие, вызывает рендер класса `Header` и рендер класса `Basket`, передавая в них данные из модели.
5. Классы `Header` и `Basket` перерисовываются, отображая обновлённые данные.